---
import { getCollection } from 'astro:content';

const allPosts = await getCollection('blog');
const recentPosts = allPosts
	.sort((a, b) => b.data.date.getTime() - a.data.date.getTime())
	.slice(0, 3);
---

<div class="sidebar-wrapper">
	<button class="sidebar-toggle" aria-label="Toggle sidebar">â˜°</button>
	
	<aside class="sidebar">
		<nav class="sidebar-nav">
			<ul>
				<li><a href="/">Home</a></li>
				<li><a href="/about">About</a></li>
				<li><a href="/links">Links</a></li>
			</ul>
		</nav>

		<div class="sidebar-recent">
			<h3>Recent</h3>
			<ul class="recent-list">
				{recentPosts.map((post) => (
					<li><a href={`/post/${post.id}`}>{post.data.title}</a></li>
				))}
			</ul>
		</div>
	</aside>
</div>

<script>
	const toggle = document.querySelector('.sidebar-toggle');
	const sidebar = document.querySelector('.sidebar');
	const wrapper = document.querySelector('.sidebar-wrapper');

	if (toggle && sidebar) {
		toggle.addEventListener('click', () => {
			sidebar.classList.toggle('open');
			toggle.classList.toggle('active');
		});

		// Close sidebar when clicking a link
		const links = sidebar.querySelectorAll('a');
		links.forEach(link => {
			link.addEventListener('click', () => {
				sidebar.classList.remove('open');
				toggle.classList.remove('active');
			});
		});
	}
</script>

<style>
	.sidebar-wrapper {
		position: relative;
	}

	.sidebar-toggle {
		display: none;
		background: var(--color-white);
		border: 3px solid var(--color-dark);
		padding: 0.4rem 0.6rem;
		font-size: 1rem;
		cursor: pointer;
		font-weight: bold;
		color: var(--color-accent-red);
		transition: all 0.2s ease;
		position: fixed;
		top: 1rem;
		left: 1rem;
		z-index: 1001;
	}

	.sidebar-toggle:hover {
		background: var(--color-bg);
		transform: scale(1.05);
	}

	.sidebar-toggle.active {
		color: var(--color-accent-blue);
	}

	.sidebar {
		background: var(--color-white);
		border: 4px solid var(--color-dark);
		padding: 1rem;
		position: sticky;
		top: 2rem;
		height: fit-content;
		box-shadow: 6px 6px 0 rgba(0, 0, 0, 0.2);
		width: 180px;
		flex-shrink: 0;
	}

	.sidebar h3 {
		color: var(--color-accent-red);
		font-family: var(--font-comic);
		font-weight: 900;
		margin: 1rem 0 0.6rem 0;
		font-size: 0.95rem;
		text-shadow: none;
	}

	.sidebar-nav ul,
	.recent-list {
		list-style: none;
		padding: 0;
		margin: 0;
	}

	.sidebar-nav li {
		margin: 0.4rem 0;
	}

	.recent-list li {
		margin: 0.35rem 0;
		font-size: 0.85rem;
	}

	.sidebar-nav a,
	.recent-list a {
		color: var(--color-accent-blue);
		text-decoration: none;
		border-bottom: 2px solid var(--color-accent-blue);
		transition: all 0.2s ease;
		font-weight: 600;
		font-size: 0.95rem;
		display: inline;
	}

	.sidebar-nav a:hover,
	.recent-list a:hover {
		color: var(--color-accent-red);
		border-bottom-color: var(--color-accent-red);
	}

	@media (max-width: 900px) {
		.sidebar-wrapper {
			position: absolute;
			width: 0;
			height: 0;
			overflow: visible;
		}

		.sidebar {
			position: fixed;
			top: 0;
			left: -250px;
			width: 240px;
			height: 100vh;
			border: 4px solid var(--color-dark);
			border-right: 8px solid var(--color-dark);
			border-radius: 0;
			z-index: 1000;
			overflow-y: auto;
			transition: left 0.3s ease;
			box-shadow: 6px 6px 0 rgba(0, 0, 0, 0.2);
			padding-top: 3.5rem;
			max-width: none;
		}

		.sidebar.open {
			left: 0;
		}

		.sidebar-toggle {
			display: block;
		}

		.sidebar-nav,
		.sidebar-recent {
			margin: 0;
		}
	}

	@media (max-width: 640px) {
		.sidebar {
			width: 220px;
			left: -220px;
		}
	}
</style>
